<!--pages/my-likes/my-likes.wxml-->
<view class="container">
  <view class="header">
    <text class="header-title">æˆ‘çš„ç‚¹èµ</text>
  </view>

  <!-- éª¨æ¶å±/åŠ è½½ä¸­ -->
  <view wx:if="{{isLoading && likedPosts.length === 0}}" class="loading-indicator">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ä¸»å†…å®¹å§‹ç»ˆæ¸²æŸ“ -->
  <view wx:else>
    <view wx:if="{{likedPosts.length > 0}}" class="post-list">
      <view wx:for="{{likedPosts}}" wx:key="_id" class="post-item" bindtap="navigateToPost" data-id="{{item._id}}">
        <!-- Author Info -->
        <view class="author-info">
          <image 
            class="author-avatar" 
            src="{{item.authorAvatar || '../../images/icons/avatar.png'}}" 
            mode="aspectFill"
            binderror="onAvatarError"
          ></image>
          <text class="author-name">{{item.authorName}}</text>
        </view>
        
        <view class="post-title">{{item.title}}</view>
        <view class="post-content-preview">{{item.content}}</view>
        
        <!-- å›¾ç‰‡æ˜¾ç¤ºé€»è¾‘ -->
        <view wx:if="{{(item.imageUrl || (item.imageUrls && item.imageUrls.length > 0))}}" class="image-container">
          <!-- å•å¼ å›¾ç‰‡æ˜¾ç¤º -->
          <block wx:if="{{item.imageUrls && item.imageUrls.length === 1}}">
            <image
              data-type="single"
              id="likes-single-img-{{index}}"
              class="post-image"
              src="{{item.imageUrls[0]}}"
              mode="aspectFit"
              binderror="onImageError"
              bindload="onImageLoad"
              catch:tap="handlePreview"
              data-src="{{item.imageUrls[0]}}"
              data-original-image-urls="{{item.originalImageUrls || item.imageUrls}}"
              data-postindex="{{index}}"
              data-imgindex="0"
              lazy-load="{{true}}"
              style="width: 100%; height: {{swiperHeights[index] !== undefined && swiperHeights[index] !== null ? swiperHeights[index] + 'px' : 'auto'}}; display: block;"
            ></image>
          </block>
          <!-- å¤šå¼ å›¾ç‰‡ swiper -->
          <block wx:elif="{{item.imageUrls && item.imageUrls.length > 1}}">
            <swiper class="image-swiper swiper-bg-white" indicator-dots="true" circular="false" autoplay="false" style="width: 100%; height: {{swiperHeights[index]}}px;">
              <block wx:for="{{item.imageUrls}}" wx:for-item="imageUrl" wx:key="*this" wx:for-index="imgindex">
                <swiper-item>
                  <image
                    data-type="multi"
                    id="likes-swiper-img-{{index}}-{{imgindex}}"
                    class="post-image"
                    src="{{imageUrl}}"
                    mode="{{imgindex == 0 ? 'aspectFit' : 'aspectFill'}}"
                    catch:tap="handlePreview"
                    data-src="{{imageUrl}}"
                    data-original-image-urls="{{item.originalImageUrls || item.imageUrls}}"
                    data-postindex="{{index}}"
                    data-imgindex="{{imgindex}}"
                    lazy-load="{{true}}"
                    style="width: 100%; height: 100%; display: block; object-fit: {{imgindex == 0 ? 'contain' : 'cover'}};"
                  ></image>
                </swiper-item>
              </block>
            </swiper>
          </block>
          <!-- å…¼å®¹è€æ•°æ®å•å›¾ -->
          <block wx:elif="{{item.imageUrl && (!item.imageUrls || item.imageUrls.length === 0)}}">
            <image 
              class="post-image" 
              src="{{item.imageUrl}}" 
              mode="widthFix"
              binderror="onImageError"
              bindload="onImageLoad"
              catch:tap="handlePreview"
              data-src="{{item.imageUrl}}"
              data-original-image-urls="{{item.originalImageUrl || item.imageUrl}}"
              data-postindex="{{index}}"
              data-imgindex="0"
              lazy-load="{{true}}"
              style="width: 100%; height: auto; display: block;"
            ></image>
          </block>
        </view>

        <!-- Post Meta -->
        <view class="post-meta">
          <text class="post-time">{{item.formattedCreateTime}}</text>
        </view>
      </view>
      <!-- åŠ è½½æ›´å¤šæç¤º -->
      <view wx:if="{{isLoading && likedPosts.length > 0}}" class="loading-indicator">
        <text>åŠ è½½ä¸­...</text>
      </view>
    </view>
    <view wx:else class="empty-tip">
      <view class="empty-icon">ğŸ‘</view>
      <view class="empty-text">ä½ è¿˜æ²¡æœ‰ç‚¹èµä»»ä½•å¸–å­å“¦ï½</view>
      <view class="empty-subtext">å»é¦–é¡µå‘ç°ç²¾å½©å†…å®¹å§ï¼</view>
    </view>
  </view>
</view>